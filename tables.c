#include "types.h"

//////////////////////////////////////////////////////////////////////////
// CABAC
//////////////////////////////////////////////////////////////////////////

const uint8_t g_bac_range_lps[128][4] =
{
    {  2,  2,  2,  2}, {128,176,208,240}, {  6,  7,  8,  9}, {128,167,197,227},
    {  6,  7,  9, 10}, {128,158,187,216}, {  6,  8,  9, 11}, {123,150,178,205},
    {  7,  8, 10, 11}, {116,142,169,195}, {  7,  9, 10, 12}, {111,135,160,185},
    {  7,  9, 11, 12}, {105,128,152,175}, {  8,  9, 11, 13}, {100,122,144,166},
    {  8, 10, 12, 14}, { 95,116,137,158}, {  9, 11, 12, 14}, { 90,110,130,150},
    {  9, 11, 13, 15}, { 85,104,123,142}, { 10, 12, 14, 16}, { 81, 99,117,135},
    { 10, 12, 15, 17}, { 77, 94,111,128}, { 11, 13, 15, 18}, { 73, 89,105,122},
    { 11, 14, 16, 19}, { 69, 85,100,116}, { 12, 14, 17, 20}, { 66, 80, 95,110},
    { 12, 15, 18, 21}, { 62, 76, 90,104}, { 13, 16, 19, 22}, { 59, 72, 86, 99},
    { 14, 17, 20, 23}, { 56, 69, 81, 94}, { 14, 18, 21, 24}, { 53, 65, 77, 89},
    { 15, 19, 22, 25}, { 51, 62, 73, 85}, { 16, 20, 23, 27}, { 48, 59, 69, 80},
    { 17, 21, 25, 28}, { 46, 56, 66, 76}, { 18, 22, 26, 30}, { 43, 53, 63, 72},
    { 19, 23, 27, 31}, { 41, 50, 59, 69}, { 20, 24, 29, 33}, { 39, 48, 56, 65},
    { 21, 26, 30, 35}, { 37, 45, 54, 62}, { 22, 27, 32, 37}, { 35, 43, 51, 59},
    { 23, 28, 33, 39}, { 33, 41, 48, 56}, { 24, 30, 35, 41}, { 32, 39, 46, 53},
    { 26, 31, 37, 43}, { 30, 37, 43, 50}, { 27, 33, 39, 45}, { 29, 35, 41, 48},
    { 29, 35, 41, 48}, { 27, 33, 39, 45}, { 30, 37, 43, 50}, { 26, 31, 37, 43},
    { 32, 39, 46, 53}, { 24, 30, 35, 41}, { 33, 41, 48, 56}, { 23, 28, 33, 39},
    { 35, 43, 51, 59}, { 22, 27, 32, 37}, { 37, 45, 54, 62}, { 21, 26, 30, 35},
    { 39, 48, 56, 65}, { 20, 24, 29, 33}, { 41, 50, 59, 69}, { 19, 23, 27, 31},
    { 43, 53, 63, 72}, { 18, 22, 26, 30}, { 46, 56, 66, 76}, { 17, 21, 25, 28},
    { 48, 59, 69, 80}, { 16, 20, 23, 27}, { 51, 62, 73, 85}, { 15, 19, 22, 25},
    { 53, 65, 77, 89}, { 14, 18, 21, 24}, { 56, 69, 81, 94}, { 14, 17, 20, 23},
    { 59, 72, 86, 99}, { 13, 16, 19, 22}, { 62, 76, 90,104}, { 12, 15, 18, 21},
    { 66, 80, 95,110}, { 12, 14, 17, 20}, { 69, 85,100,116}, { 11, 14, 16, 19},
    { 73, 89,105,122}, { 11, 13, 15, 18}, { 77, 94,111,128}, { 10, 12, 15, 17},
    { 81, 99,117,135}, { 10, 12, 14, 16}, { 85,104,123,142}, {  9, 11, 13, 15},
    { 90,110,130,150}, {  9, 11, 12, 14}, { 95,116,137,158}, {  8, 10, 12, 14},
    {100,122,144,166}, {  8,  9, 11, 13}, {105,128,152,175}, {  7,  9, 11, 12},
    {111,135,160,185}, {  7,  9, 10, 12}, {116,142,169,195}, {  7,  8, 10, 11},
    {123,150,178,205}, {  6,  8,  9, 11}, {128,158,187,216}, {  6,  7,  9, 10},
    {128,167,197,227}, {  6,  7,  8,  9}, {128,176,208,240}, {  2,  2,  2,  2}
};

const uint8_t g_bac_transition[128][2] =
{
    {  0,  0}, {126,  3}, {  2, 50}, {  1,  5},
    {  2, 50}, {  3,  7}, {  4, 52}, {  5,  9},
    {  6, 52}, {  5, 11}, {  8, 52}, {  9, 13},
    { 10, 54}, {  9, 15}, { 12, 54}, { 11, 17},
    { 14, 54}, { 13, 19}, { 16, 56}, { 15, 21},
    { 18, 56}, { 17, 23}, { 20, 56}, { 19, 25},
    { 22, 58}, { 19, 27}, { 24, 58}, { 23, 29},
    { 26, 60}, { 23, 31}, { 28, 60}, { 25, 33},
    { 30, 60}, { 27, 35}, { 32, 62}, { 27, 37},
    { 34, 62}, { 31, 39}, { 36, 64}, { 31, 41},
    { 38, 66}, { 33, 43}, { 40, 66}, { 33, 45},
    { 42, 66}, { 37, 47}, { 44, 68}, { 37, 49},
    { 46, 68}, { 39, 51}, { 48, 70}, { 39, 53},
    { 50, 72}, { 43, 55}, { 52, 72}, { 43, 57},
    { 54, 74}, { 45, 59}, { 56, 74}, { 45, 61},
    { 58, 76}, { 47, 63}, { 60, 78}, { 49, 65},
    { 62, 78}, { 49, 67}, { 64, 80}, { 51, 69},
    { 66, 82}, { 53, 71}, { 68, 82}, { 53, 73},
    { 70, 84}, { 55, 75}, { 72, 84}, { 55, 77},
    { 74, 88}, { 57, 79}, { 76, 88}, { 59, 81},
    { 78, 90}, { 59, 83}, { 80, 90}, { 61, 85},
    { 82, 94}, { 61, 87}, { 84, 94}, { 61, 89},
    { 86, 96}, { 63, 91}, { 88, 96}, { 65, 93},
    { 90,100}, { 65, 95}, { 92,100}, { 67, 97},
    { 94,102}, { 67, 99}, { 96,104}, { 67,101},
    { 98,104}, { 69,103}, {100,108}, { 69,105},
    {102,108}, { 71,107}, {104,110}, { 71,109},
    {106,112}, { 71,111}, {108,114}, { 73,113},
    {110,116}, { 73,115}, {112,118}, { 73,117},
    {114,118}, { 75,119}, {116,122}, { 75,121},
    {118,122}, { 75,123}, {120,124}, { 77,125},
    {122,126}, { 77,125}, {124,  1}, {127,127}
};

const uint8_t g_bac_renorm[512] =
{
    7, 7, 7, 7, 6, 6, 6, 6, 5, 5, 5, 5, 5, 5, 5, 5,
    4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4,
    3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
    3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,
    2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
};



const int32_t pos2ctx_map2x4c[16] =
{
    0,  0,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2
};

const int32_t pos2ctx_map4x4c[16] =
{
    0,  0,  0,  0,  1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2
};

const int32_t pos2ctx_last2x4c[16] =
{
    0,  0,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2,  2
};

const int32_t pos2ctx_last4x4c[16] =
{
    0,  0,  0,  0,  1,  1,  1,  1,  2,  2,  2,  2,  2,  2,  2,  2
};


#define EMPTY_CTX { 0, 0 }

const bac_init_ctx_t ctx_mb_type[2][2][10] =
{{
    {{ 20,-15}, {  2, 54}, {  3, 74}, {-28,127}, {-23,104}, { -6, 53}, { -1, 54}, {  7, 51}, EMPTY_CTX, EMPTY_CTX},
    {EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
},{
    {{ 23, 33}, { 23,  2}, { 21,  0}, {  1,  9}, {  0, 49}, {-37,118}, {  5, 57}, {-13, 78}, {-11, 65}, {  1, 62}},
    {{ 26, 67}, { 16, 90}, {  9,104}, {-46,127}, {-20,104}, {  1, 67}, { 18, 64}, {  9, 43}, { 29,  0}, EMPTY_CTX}
}};

const bac_init_ctx_t ctx_b8_type[2][4] =
{
    {{ 12, 49}, { -4, 73}, { 17, 50}, EMPTY_CTX},
    {{ -6, 86}, {-17, 95}, { -6, 61}, {  9, 45}}
};

const bac_init_ctx_t ctx_mvd[2][8] =
{
    {{ -3, 69}, { -6, 81}, {-11, 96}, EMPTY_CTX, {  0, 58}, { -3, 76}, {-10, 94}, EMPTY_CTX},
    {{  6, 55}, {  7, 67}, { -5, 86}, {  2, 88}, {  5, 54}, {  4, 69}, { -3, 81}, {  0, 88}}
};

const bac_init_ctx_t ctx_idx[6] =
{
    { -7, 67}, { -5, 74}, { -4, 74}, { -5, 80}, { -7, 72}, {  1, 58}
};

const bac_init_ctx_t ctx_mb_aff[2][3] =
{
    {{  0, 11}, {  1, 55}, {  0, 69}},
    {{  0, 45}, { -4, 78}, { -3, 96}}
};

const bac_init_ctx_t ctx_dct_size[2][3] =
{
    {{ 31, 21}, { 31, 31}, { 25, 50}},
    {{ 12, 40}, { 11, 51}, { 14, 59}}
};

const bac_init_ctx_t ctx_delta_qp[4] =
{
    {  0, 41}, {  0, 63}, {  0, 63}, {  0, 63}
};

const bac_init_ctx_t ctx_yip[2] =
{
    { 13, 41}, {  3, 62}
};

const bac_init_ctx_t ctx_cip[4] =
{
    { -9, 83}, {  4, 86}, {  0, 97}, { -7, 72}
};

const bac_init_ctx_t ctx_cbp[2][3][4] =
{{
    {{-17,127}, {-13,102}, {  0, 82}, { -7, 74}},
    {{-21,107}, {-27,127}, {-31,127}, {-24,127}},
    {{-18, 95}, {-27,127}, {-21,114}, {-30,127}}
},{
    {{-27,126}, {-28, 98}, {-25,101}, {-23, 67}},
    {{-28, 82}, {-20, 94}, {-16, 83}, {-22,110}},
    {{-21, 91}, {-18,102}, {-13, 93}, {-29,127}}
}};

const bac_init_ctx_t ctx_bcbp[2][6][4] =
{{
    {{-17,123}, {-12,115}, {-16,122}, {-11,115}},
    {{-12, 63}, { -2, 68}, {-15, 84}, {-13,104}},
    {EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX},
    {{ -3, 70}, { -8, 93}, {-10, 90}, {-30,127}},
    {{ -4, 56}, { -5, 82}, { -7, 76}, {-22,125}},
    {{ -1, 74}, { -6, 97}, { -7, 91}, {-20,127}}
},{
    {{ -7, 92}, { -5, 89}, { -7, 96}, {-13,108}},
    {{ -3, 46}, { -1, 65}, { -1, 57}, { -9, 93}},
    {EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX},
    {{ -3, 74}, { -9, 92}, { -8, 87}, {-23,126}},
    {{ -1, 48}, {  0, 68}, { -4, 69}, { -8, 88}},
    {{  5, 54}, {  6, 60}, {  6, 59}, {  6, 69}}
}};

const bac_init_ctx_t ctx_one[2][6][5] =
{{
    {{ -3, 71}, { -6, 42}, { -5, 50}, { -3, 54}, { -2, 62}},
    {{ -5, 67}, { -5, 27}, { -3, 39}, { -2, 44}, {  0, 46}},
    {{ -3, 75}, { -1, 23}, {  1, 34}, {  1, 43}, {  0, 54}},
    {{-12, 92}, {-15, 55}, {-10, 60}, { -6, 62}, { -4, 65}},
    {{ -8, 78}, { -5, 33}, { -4, 48}, { -2, 53}, { -3, 62}},
    {{-11, 97}, {-20, 84}, {-11, 79}, { -6, 73}, { -4, 74}}
},{
    {{ -6, 76}, { -2, 44}, {  0, 45}, {  0, 52}, { -3, 64}},
    {{ -9, 77}, {  3, 24}, {  0, 42}, {  0, 48}, {  0, 55}},
    {{ -6, 66}, { -7, 35}, { -7, 42}, { -8, 45}, { -5, 48}},
    {{  1, 58}, { -3, 29}, { -1, 36}, {  1, 38}, {  2, 43}},
    {{  0, 58}, {  8,  5}, { 10, 14}, { 14, 18}, { 13, 27}},
    {{  0, 70}, { -4, 29}, {  5, 31}, {  7, 42}, {  1, 59}}
}};

const bac_init_ctx_t ctx_abs[2][6][5] =
{{
    {{  0, 58}, {  1, 63}, { -2, 72}, { -1, 74}, { -9, 91}},
    {{-16, 64}, { -8, 68}, {-10, 78}, { -6, 77}, {-10, 86}},
    {{ -2, 55}, {  0, 61}, {  1, 64}, {  0, 68}, { -9, 92}},
    {{-12, 73}, { -8, 76}, { -7, 80}, { -9, 88}, {-17,110}},
    {{-13, 71}, {-10, 79}, {-12, 86}, {-13, 90}, {-14, 97}},
    {{-13, 86}, {-13, 96}, {-11, 97}, {-19,117}, EMPTY_CTX}
},{
    {{ -2, 59}, { -4, 70}, { -4, 75}, { -8, 82}, {-17,102}},
    {{ -6, 59}, { -7, 71}, {-12, 83}, {-11, 87}, {-30,119}},
    {{-12, 56}, { -6, 60}, { -5, 62}, { -8, 66}, { -8, 76}},
    {{ -6, 55}, {  0, 58}, {  0, 64}, { -3, 74}, {-10, 90}},
    {{  2, 40}, {  0, 58}, { -3, 70}, { -6, 79}, { -8, 85}},
    {{ -2, 58}, { -3, 72}, { -3, 81}, {-11, 97}, EMPTY_CTX}
}};

const bac_init_ctx_t ctx_frm_map[2][6][15] =
{{
    {{ -7, 93}, {-11, 87}, { -3, 77}, { -5, 71}, { -4, 63}, { -4, 68}, {-12, 84}, { -7, 62}, { -7, 65}, {  8, 61}, {  5, 56}, { -2, 66}, {  1, 64}, {  0, 61}, { -2, 78}},
    {{  1, 50}, {  7, 52}, { 10, 35}, {  0, 44}, { 11, 38}, {  1, 45}, {  0, 46}, {  5, 44}, { 31, 17}, {  1, 51}, {  7, 50}, { 28, 19}, { 16, 33}, { 14, 62}, EMPTY_CTX},
    {{-17,120}, {-20,112}, {-18,114}, {-11, 85}, {-15, 92}, {-14, 89}, {-26, 71}, {-15, 81}, {-14, 80}, {  0, 68}, {-14, 70}, {-24, 56}, {-23, 68}, {-24, 50}, {-11, 74}},
    {{-13,108}, {-15,100}, {-13,101}, {-13, 91}, {-12, 94}, {-10, 88}, {-16, 84}, {-10, 86}, { -7, 83}, {-13, 87}, {-19, 94}, {  1, 70}, {  0, 72}, { -5, 74}, { 18, 59}},
    {{ -4, 75}, {  2, 72}, {-11, 75}, { -3, 71}, { 15, 46}, {-13, 69}, {  0, 62}, {  0, 65}, { 21, 37}, {-15, 72}, {  9, 57}, { 16, 54}, {  0, 62}, { 12, 72}, EMPTY_CTX},
    {{ -8,102}, {-15,100}, {  0, 95}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
},{
    {{ -2, 85}, { -6, 78}, { -1, 75}, { -7, 77}, {  2, 54}, {  5, 50}, { -3, 68}, {  1, 50}, {  6, 42}, { -4, 81}, {  1, 63}, { -4, 70}, {  0, 67}, {  2, 57}, { -2, 76}},
    {{ 11, 35}, {  4, 64}, {  1, 61}, { 11, 35}, { 18, 25}, { 12, 24}, { 13, 29}, { 13, 36}, {-10, 93}, { -7, 73}, { -2, 73}, { 13, 46}, {  9, 49}, { -7,100}, EMPTY_CTX},
    {{ -4, 79}, { -7, 71}, { -5, 69}, { -9, 70}, { -8, 66}, {-10, 68}, {-19, 73}, {-12, 69}, {-16, 70}, {-15, 67}, {-20, 62}, {-19, 70}, {-16, 66}, {-22, 65}, {-20, 63}},
    {{  9, 53}, {  2, 53}, {  5, 53}, { -2, 61}, {  0, 56}, {  0, 56}, {-13, 63}, { -5, 60}, { -1, 62}, {  4, 57}, { -6, 69}, {  4, 57}, { 14, 39}, {  4, 51}, { 13, 68}},
    {{  7, 50}, { 16, 39}, {  5, 44}, {  4, 52}, { 11, 48}, { -5, 60}, { -1, 59}, {  0, 59}, { 22, 33}, {  5, 44}, { 14, 43}, { -1, 78}, {  0, 60}, {  9, 69}, EMPTY_CTX},
    {{  3, 64}, {  1, 61}, {  9, 63}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
}};

const bac_init_ctx_t ctx_fld_map[2][6][15] =
{{
    {{ -6, 93}, { -6, 84}, { -8, 79}, {  0, 66}, { -1, 71}, {  0, 62}, { -2, 60}, { -2, 59}, { -5, 75}, { -3, 62}, { -4, 58}, { -9, 66}, { -1, 79}, {  0, 71}, {  3, 68}},
    {{ 10, 44}, { -7, 62}, { 15, 36}, { 14, 40}, { 16, 27}, { 12, 29}, {  1, 44}, { 20, 36}, { 18, 32}, {  5, 42}, {  1, 48}, { 10, 62}, { 17, 46}, {  9, 64}, EMPTY_CTX},
    {{-14,106}, {-13, 97}, {-15, 90}, {-12, 90}, {-18, 88}, {-10, 73}, { -9, 79}, {-14, 86}, {-10, 73}, {-10, 70}, {-10, 69}, { -5, 66}, { -9, 64}, { -5, 58}, {  2, 59}},
    {{-12,104}, {-11, 97}, {-16, 96}, { -7, 88}, { -8, 85}, { -7, 85}, { -9, 85}, {-13, 88}, {  4, 66}, { -3, 77}, { -3, 76}, { -6, 76}, { 10, 58}, { -1, 76}, { -1, 83}},
    {{  0, 76}, { -5, 74}, {  0, 70}, {-11, 75}, {  1, 68}, {  0, 65}, {-14, 73}, {  3, 62}, {  4, 62}, { -1, 68}, {-13, 75}, { 11, 55}, {  5, 64}, { 12, 70}, EMPTY_CTX},
    {{ -7, 99}, {-14, 95}, {  2, 95}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
},{
    {{-13,106}, {-16,106}, {-10, 87}, {-21,114}, {-18,110}, {-14, 98}, {-22,110}, {-21,106}, {-18,103}, {-21,107}, {-23,108}, {-26,112}, {-10, 96}, {-12, 95}, { -5, 91}},
    {{ -9, 93}, {-22, 94}, { -5, 86}, {  9, 67}, { -4, 80}, {-10, 85}, { -1, 70}, {  7, 60}, {  9, 58}, {  5, 61}, { 12, 50}, { 15, 50}, { 18, 49}, { 17, 54}, EMPTY_CTX},
    {{ -5, 85}, { -6, 81}, {-10, 77}, { -7, 81}, {-17, 80}, {-18, 73}, { -4, 74}, {-10, 83}, { -9, 71}, { -9, 67}, { -1, 61}, { -8, 66}, {-14, 66}, {  0, 59}, {  2, 59}},
    {{ 10, 41}, {  7, 46}, { -1, 51}, {  7, 49}, {  8, 52}, {  9, 41}, {  6, 47}, {  2, 55}, { 13, 41}, { 10, 44}, {  6, 50}, {  5, 53}, { 13, 49}, {  4, 63}, {  6, 64}},
    {{ 10, 44}, {  9, 31}, { 12, 43}, {  3, 53}, { 14, 34}, { 10, 38}, { -3, 52}, { 13, 40}, { 17, 32}, {  7, 44}, {  7, 38}, { 13, 50}, { 10, 57}, { 26, 43}, EMPTY_CTX},
    {{ -2, 69}, { -2, 59}, {  6, 70}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
}};

const bac_init_ctx_t ctx_frm_last[2][6][15] =
{{
    {{ 24,  0}, { 15,  9}, {  8, 25}, { 13, 18}, { 15,  9}, { 13, 19}, { 10, 37}, { 12, 18}, {  6, 29}, { 20, 33}, { 15, 30}, {  4, 45}, {  1, 58}, {  0, 62}, {  7, 61}},
    {{ 12, 38}, { 11, 45}, { 15, 39}, { 11, 42}, { 13, 44}, { 16, 45}, { 12, 41}, { 10, 49}, { 30, 34}, { 18, 42}, { 10, 55}, { 17, 51}, { 17, 46}, {  0, 89}, EMPTY_CTX},
    {{ 23,-13}, { 26,-13}, { 40,-15}, { 49,-14}, { 44,  3}, { 45,  6}, { 44, 34}, { 33, 54}, { 19, 82}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX},
    {{ 26,-19}, { 22,-17}, { 26,-17}, { 30,-25}, { 28,-20}, { 33,-23}, { 37,-27}, { 33,-23}, { 40,-28}, { 38,-17}, { 33,-11}, { 40,-15}, { 41, -6}, { 38,  1}, { 41, 17}},
    {{ 37,-16}, { 35, -4}, { 38, -8}, { 38, -3}, { 37,  3}, { 38,  5}, { 42,  0}, { 35, 16}, { 39, 22}, { 14, 48}, { 27, 37}, { 21, 60}, { 12, 68}, {  2, 97}, EMPTY_CTX},
    {{ 30, -6}, { 27,  3}, { 26, 22}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
},{
    {{ 11, 28}, {  2, 40}, {  3, 44}, {  0, 49}, {  0, 46}, {  2, 44}, {  2, 51}, {  0, 47}, {  4, 39}, {  2, 62}, {  6, 46}, {  0, 54}, {  3, 54}, {  2, 58}, {  4, 63}},
    {{  6, 51}, {  6, 57}, {  7, 53}, {  6, 52}, {  6, 55}, { 11, 45}, { 14, 36}, {  8, 53}, { -1, 82}, {  7, 55}, { -3, 78}, { 15, 46}, { 22, 31}, { -1, 84}, EMPTY_CTX},
    {{  9, -2}, { 26, -9}, { 33, -9}, { 39, -7}, { 41, -2}, { 45,  3}, { 49,  9}, { 45, 27}, { 36, 59}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX},
    {{ 25,  7}, { 30, -7}, { 28,  3}, { 28,  4}, { 32,  0}, { 34, -1}, { 30,  6}, { 30,  6}, { 32,  9}, { 31, 19}, { 26, 27}, { 26, 30}, { 37, 20}, { 28, 34}, { 17, 70}},
    {{ 16, 30}, { 18, 32}, { 18, 35}, { 22, 29}, { 24, 31}, { 23, 38}, { 18, 43}, { 20, 41}, { 11, 63}, {  9, 59}, {  9, 64}, { -1, 94}, { -2, 89}, { -9,108}, EMPTY_CTX},
    {{  1, 67}, {  5, 59}, {  9, 67}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
}};

const bac_init_ctx_t ctx_fld_last[2][6][15] =
{{
    {{ 15,  6}, {  6, 19}, {  7, 16}, { 12, 14}, { 18, 13}, { 13, 11}, { 13, 15}, { 15, 16}, { 12, 23}, { 13, 23}, { 15, 20}, { 14, 26}, { 14, 44}, { 17, 40}, { 17, 47}},
    {{ 24, 17}, { 21, 21}, { 25, 22}, { 31, 27}, { 22, 29}, { 19, 35}, { 14, 50}, { 10, 57}, {  7, 63}, { -2, 77}, { -4, 82}, { -3, 94}, {  9, 69}, {-12,109}, EMPTY_CTX},
    {{ 21,-10}, { 24,-11}, { 28, -8}, { 28, -1}, { 29,  3}, { 29,  9}, { 35, 20}, { 29, 36}, { 14, 67}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX},
    {{ 36,-35}, { 36,-34}, { 32,-26}, { 37,-30}, { 44,-32}, { 34,-18}, { 34,-15}, { 40,-15}, { 33, -7}, { 35, -5}, { 33,  0}, { 38,  2}, { 33, 13}, { 23, 35}, { 13, 58}},
    {{ 31, -7}, { 35,-15}, { 34, -3}, { 34,  3}, { 36, -1}, { 34,  5}, { 32, 11}, { 35,  5}, { 34, 12}, { 39, 11}, { 30, 29}, { 34, 26}, { 29, 39}, { 19, 66}, EMPTY_CTX},
    {{ 29, -3}, { 26,  0}, { 22, 30}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
},{
    {{ 14, 11}, { 11, 14}, {  9, 11}, { 18, 11}, { 21,  9}, { 23, -2}, { 32,-15}, { 32,-15}, { 34,-21}, { 39,-23}, { 42,-33}, { 41,-31}, { 46,-28}, { 38,-12}, { 21, 29}},
    {{ 45,-24}, { 53,-45}, { 48,-26}, { 65,-43}, { 43,-19}, { 39,-10}, { 30,  9}, { 18, 26}, { 20, 27}, {  0, 57}, {-14, 82}, { -5, 75}, {-19, 97}, {-35,125}, EMPTY_CTX},
    {{ 21,-13}, { 33,-14}, { 39, -7}, { 46, -2}, { 51,  2}, { 60,  6}, { 61, 17}, { 55, 34}, { 42, 62}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX},
    {{ 27,  0}, { 28,  0}, { 31, -4}, { 27,  6}, { 34,  8}, { 30, 10}, { 24, 22}, { 33, 19}, { 22, 32}, { 26, 31}, { 21, 41}, { 26, 44}, { 23, 47}, { 16, 65}, { 14, 71}},
    {{ 21, 24}, { 23, 20}, { 26, 23}, { 27, 32}, { 28, 23}, { 28, 24}, { 23, 40}, { 24, 32}, { 28, 29}, { 23, 42}, { 19, 57}, { 22, 53}, { 22, 61}, { 11, 86}, EMPTY_CTX},
    {{  8, 60}, {  6, 63}, { 17, 65}, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX, EMPTY_CTX}
}};

const int32_t g_log2_plus_one[256] =
{
    1, 1, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4,
    5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,
    6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
    6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6,
    7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
    7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
    7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
    7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8,
    8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8
};

#undef EMPTY_CTX


